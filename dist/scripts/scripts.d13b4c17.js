"use strict";angular.module("hnlyticsApp",["firebase","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angles","ui.bootstrap","ui.router"]).constant("_",window._).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/user/pg/bytime"),a.state("selectFork",{url:"/select-fork",templateUrl:"views/partials/selectView.html"}).state("topStories",{url:"/top-stories",templateUrl:"views/partials/topStoriesView.html",controller:"TrendingCtrl"}).state("topStories.list",{url:"/list",templateUrl:"views/topList.html",controller:"TopListCtrl",resolve:{topStories:["topStoriesService",function(a){return a.getTopStories()}]}}).state("topStories.story",{url:"/:storyId",templateUrl:"views/story.html",controller:"PostStatsCtrl",resolve:{activityData:["chartsService","$stateParams",function(a,b){return console.log("YOOO"),a.postActivity(b.storyId)}]}}).state("userFork",{url:"/user",templateUrl:"views/partials/userDataView.html",controller:"MainCtrl"}).state("userFork.bytime",{url:"/:userId/bytime",templateUrl:"views/main.html",controller:"TimeOfDayCtrl",resolve:{timeOfDayChart:["chartsService","$stateParams",function(a,b){return a.timeOfDay(b.userId)}]}}).state("userFork.toppost",{url:"/:userId/toppost",templateUrl:"views/toppost.html",controller:"TopPostCtrl",resolve:{activityData:["chartsService","$stateParams",function(a,b){return a.topPostActivity(b.userId)}]}}).state("userFork.lastpost",{url:"/:userId/lastpost",templateUrl:"views/latest.html",controller:"LatestCtrl",resolve:{activityData:["chartsService","$stateParams",function(a,b){return a.lastPostActivity(b.userId)}]}})}]),angular.module("hnlyticsApp").controller("MainCtrl",["$scope","$sce","$location","$stateParams","$rootScope","UserStatsService",function(a,b,c,d,e,f){function g(){f.results(d.userId).then(function(b){return a.userStats=b,a.dgntData=[{label:"Comments",value:b.comments,color:"#949FB1"},{label:"Stories",value:b.stories,color:"#F7464A"}],b})}e.user=d.userId,a.current=1,a.setCurrent=function(b){a.current=b},a.$on("route:changed",function(){g()}),g(),a.pullUserData=function(b){a.current=1,c.path("/user/"+b+"/bytime")}}]),angular.module("hnlyticsApp").controller("LatestCtrl",["$scope","$stateParams","chartsService","$rootScope","activityData",function(a,b,c,d,e){d.user=b.userId,a.lastPostChart=e.chart,a.chartInfo=e.chartInfo,a.sentiment=e.sentiment,a.chartInfo.created_at=moment(e.chartInfo.created_at).format("M/D/YYYY"),a.$on("New User Data",function(b,d){c.latestPostActivity().then(function(b){a.lastPostChart=b.chart}),console.log("==================DATA",d)})}]),angular.module("hnlyticsApp").controller("TopPostCtrl",["$scope","$rootScope","$stateParams","$firebase","$timeout","$sce","activityData",function(a,b,c,d,e,f,g){b.user=c.userId,a.topPostChart=g.chart,a.chartInfo=g.chartInfo,a.sentiment=g.sentiment,a.chartInfo.created_at=moment(g.chartInfo.created_at).format("M/D/YYYY")}]),angular.module("hnlyticsApp").controller("TimeOfDayCtrl",["$scope","$stateParams","timeOfDayChart","$rootScope","subsByPeriodService","chartsService",function(a,b,c,d,e,f){d.user=b.userId,a.$emit("route:changed",b.userId),a.chart=c.chart,a.$on("New User Data",function(b,c){f.timeOfDay().then(function(b){a.chart=b.chart}),console.log("==================DATA",c)})}]),angular.module("hnlyticsApp").controller("TopListCtrl",["$scope","topStories",function(a,b){a.topStories=b.storiesArr,a.sentiment=b.sentiment,a.dgntData=[{label:b.highFrequency[0].text,value:b.highFrequency[0].frequency,color:"#F7464A"},{label:b.highFrequency[1].text,value:b.highFrequency[1].frequency,color:"#F7464A"},{label:b.highFrequency[2].text,value:b.highFrequency[2].frequency,color:"#F7464A"},{label:b.highFrequency[3].text,value:b.highFrequency[3].frequency,color:"#F7464A"},{label:b.highFrequency[4].text,value:b.highFrequency[4].frequency,color:"#E2EAE9"},{label:b.highFrequency[5].text,value:b.highFrequency[5].frequency,color:"#D4CCC5"},{label:b.highFrequency[6].text,value:b.highFrequency[6].frequency,color:"#D4CCC5"},{label:b.highFrequency[7].text,value:b.highFrequency[7].frequency,color:"#949FB1"},{label:b.highFrequency[8].text,value:b.highFrequency[8].frequency,color:"#949FB1"},{label:b.highFrequency[9].text,value:b.highFrequency[9].frequency,color:"#4D5360"},{label:b.highFrequency[10].text,value:b.highFrequency[10].frequency,color:"#4D5360"}]}]),angular.module("hnlyticsApp").controller("TrendingCtrl",["$scope","$location",function(a,b){a.userEntered=function(){console.log("heyyyy user inputted"),b.path("/user/"+a.inputUser+"/bytime")}}]),angular.module("hnlyticsApp").controller("PostStatsCtrl",["$scope","$rootScope","$stateParams","$firebase","$timeout","$sce","activityData",function(a,b,c,d,e,f,g){b.user=c.userId,a.PostChart=g.chart,a.chartInfo=g.chartInfo,a.sentiment=g.sentiment,a.chartInfo.created_at=moment(g.chartInfo.created_at).format("M/D/YYYY")}]),angular.module("hnlyticsApp").service("UserStatsService",["$firebase","$sce","$timeout","$stateParams","$http","$q","$rootScope",function(a,b,c,d,e,f,g){var h=function(c){console.log(d.userId);var f=new Firebase("https://hacker-news.firebaseio.com/v0/"),g=f.child("user").child(d.userId),h=a(g),i=h.$asObject();i.$loaded(function(){e.get("/api/"+d.userId+"/user-info").success(function(a){console.log(a);var d=a.stories,e=a.comments,f=b.trustAsHtml(a.basic.about),g=a.basic.karma,h=a.comments+a.stories,i=new Date(1e3*a.basic.created_at_i);c({stories:d,comments:e,karma:g,about:f,submitted:h,createdAt:i.getMonth()+"/"+i.getFullYear()})})})};return{results:function(){var a=f.defer();return h(function(b){c(function(){g.$apply(function(){a.resolve(b)})})}),a.promise}}}]),angular.module("hnlyticsApp").service("averageTimeOfDayService",["$rootScope","$timeout","$http","$q","$stateParams",function(a,b,c,d,e){var f=function(a,b){console.log(e),c.get("/api/"+a+"/hourly-averages").success(function(a){console.log("got the data"),console.log(a),b(a)})};return{timesOfTheDay:function(c){var e=d.defer();return f(c,function(c){b(function(){a.$apply(function(){e.resolve(c)})})}),e.promise}}}]),angular.module("hnlyticsApp").directive("leftNav",["$rootScope",function(){return{restrict:"EA",scope:{},controller:["$scope",function(a){a.current=1,a.setCurrent=function(b){a.current=b}}],link:function(){}}}]),angular.module("hnlyticsApp").service("chartsService",["lastPostCommentsService","PostStatsService","topPostCommentsService","averageTimeOfDayService",function(a,b,c,d){var e=function(a){console.log(a);var b=d.timesOfTheDay(a).then(function(a){var b={labels:["midnight","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","Noon","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"],datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#FF6600",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:a}]},c={chart:b,chartInfo:a};return c});return b},f=function(b){var c=a.lastPostActivity(b).then(function(a){var b={labels:a.labels,datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#FF6600",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:a.commentArr}]},c={chart:b,chartInfo:a.postObj,sentiment:a.sentiment};return c});return c},g=function(a){console.log(a);var c=b.PostActivity(a).then(function(a){console.log(a);var b={labels:a.labels,datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#FF6600",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:a.commentArr}]},c={chart:b,chartInfo:a.postObj[0],sentiment:a.sentiment};return c});return c},h=function(a){var b=c.topPostActivity(a).then(function(a){var b={labels:a.labels,datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#FF6600",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:a.commentArr}]},c={chart:b,chartInfo:a.postObj,sentiment:a.sentiment};return c});return b};return{timeOfDay:e,lastPostActivity:f,topPostActivity:h,postActivity:g}}]),angular.module("hnlyticsApp").service("lastPostCommentsService",["$firebase","$q","$timeout","$rootScope","$http",function(a,b,c,d,e){var f=function(a,b){e.get("/api/"+a+"/last-post").success(function(a){console.log("got the data"),console.log(a),b(a)})};return{lastPostActivity:function(a){var e=b.defer();return f(a,function(a){console.log(a),c(function(){d.$apply(function(){e.resolve(a)})})}),e.promise}}}]),angular.module("hnlyticsApp").service("subsByPeriodService",["$firebase","$timeout","$http","$q","$rootScope",function(){var a=function(){};return{getSubsByPeriod:a}}]),Date.prototype.getWeek=function(a){a="int"==typeof a?a:0;var b=new Date(this.getFullYear(),0,1),c=b.getDay()-a;c=c>=0?c:c+7;var d,e=Math.floor((this.getTime()-b.getTime()-6e4*(this.getTimezoneOffset()-b.getTimezoneOffset()))/864e5)+1;return 4>c?(d=Math.floor((e+c-1)/7)+1,d>52&&(nYear=new Date(this.getFullYear()+1,0,1),nday=nYear.getDay()-a,nday=nday>=0?nday:nday+7,d=4>nday?1:53)):d=Math.floor((e+c-1)/7),d},angular.module("hnlyticsApp").service("topPostCommentsService",["$firebase","$q","$timeout","$rootScope","$http",function(a,b,c,d,e){var f=function(a,b){e.get("/api/"+a+"/top-post").success(function(a){console.log("got the data"),console.log(a),b(a)})};return{topPostActivity:function(a){var e=b.defer();return f(a,function(a){c(function(){console.log(a),d.$apply(function(){e.resolve(a)})})}),e.promise}}}]),angular.module("hnlyticsApp").service("topStoriesService",["$rootScope","$timeout","$http","$q","$stateParams",function(a,b,c,d,e){var f=function(a){console.log(e),c.get("/api/top-stories").success(function(b){console.log("got the data"),a(b)})};return{getTopStories:function(){var c=d.defer();return f(function(d){console.log("hey"),b(function(){a.$apply(function(){c.resolve(d)})})}),c.promise}}}]),angular.module("hnlyticsApp").service("PostStatsService",["$q","$timeout","$rootScope","$http",function(a,b,c,d){var e=function(a,b){console.log(a),d.get("/api/posts/"+a).success(function(a){console.log("got the data"),console.log(a),b(a)})};return{PostActivity:function(d){var f=a.defer();return e(d,function(a){console.log(a),b(function(){c.$apply(function(){f.resolve(a)})})}),f.promise}}}]);