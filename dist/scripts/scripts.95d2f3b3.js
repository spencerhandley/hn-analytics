"use strict";angular.module("hnlyticsApp",["firebase","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angles","ngStorage"]).constant("_",window._).config(["$routeProvider",function(a){a.when("/:userId",{templateUrl:"views/main.html",controller:"TimeOfDayCtrl",resolve:{timeOfDayChart:["chartsService",function(a){return a.timeOfDay()}],subsByPeriod:["subsByPeriodService",function(a){return a.getSubsByPeriod()}]}}).when("/:userId/latest",{templateUrl:"views/latest.html",controller:"LatestCtrl",resolve:{activityData:["chartsService",function(a){return a.lastPostActivity()}]}}).when("/:userId/toppost",{templateUrl:"views/toppost.html",controller:"TopPostCtrl",resolve:{activityData:["chartsService",function(a){return a.topPostActivity()}]}}).when("/:userId/wordmap",{templateUrl:"views/global.html",controller:"WorldMapCtrl"}).otherwise({redirectTo:"/pg"})}]),angular.module("hnlyticsApp").controller("MainCtrl",["$scope","$location","$route","$routeParams","$rootScope","UserStatsService",function(a,b,c,d,e,f){function g(){f.results(e.user).then(function(b){return console.log(b),a.userStats=b,a.dgntData=[{label:"Comments",value:b.comments,color:"#949FB1"},{label:"Stories",value:b.stories,color:"#F7464A"}],b})}a.$on("child:changed",function(a){console.log("===============================",a)}),e.user="pg",a.current=1,a.setCurrent=function(b){a.current=b},a.myChartOptions={},g(),a.pullUserData=function(a){e.user=a,g(),b.path("/"+a)}}]),angular.module("hnlyticsApp").controller("LatestCtrl",["$scope","chartsService","activityData",function(a,b,c){a.lastPostChart=c.chart,a.chartInfo=c.chartInfo,a.$on("New User Data",function(c,d){b.latestPostActivity().then(function(b){a.lastPostChart=b.chart}),console.log("==================DATA",d)})}]),angular.module("hnlyticsApp").controller("TopPostCtrl",["$scope","$firebase","$timeout","$sce","activityData",function(a,b,c,d,e){a.topPostChart=e.chart,a.chartInfo=e.chartInfo}]),angular.module("hnlyticsApp").controller("TimeOfDayCtrl",["$scope","timeOfDayChart","$routeParams","$rootScope","subsByPeriodService","chartsService","subsByPeriod",function(a,b,c,d,e,f){d.user=c.userId,a.chart=b.chart,a.$on("New User Data",function(b,c){f.timeOfDay().then(function(b){a.chart=b.chart}),console.log("==================DATA",c)})}]),angular.module("hnlyticsApp").service("UserStatsService",["$firebase","$timeout","$http","$q","$rootScope","$localStorage",function(a,b,c,d,e){var f=function(b,d){var f=new Firebase("https://hacker-news.firebaseio.com/v0/"),g=f.child("user").child(b),h=a(g),i=h.$asObject();i.$loaded(function(){c.get("/api/"+e.user+"/user-info").success(function(a){console.log(a);var b=a.stories,c=a.comments,e=a.basic.about,f=a.basic.karma,g=a.comments+a.stories,h=new Date(1e3*a.basic.created_at_i);d({stories:b,comments:c,karma:f,about:e,submitted:g,createdAt:h.getMonth()+"/"+h.getFullYear()})})})};return{results:function(a){var c=d.defer();return f(a,function(a){b(function(){e.$apply(function(){c.resolve(a)})})}),c.promise}}}]),angular.module("hnlyticsApp").service("averageTimeOfDayService",["$firebase","$timeout","$http","$q","$rootScope",function(a,b,c,d,e){var f=function(a){c.get("/api/"+e.user+"/hourly-averages").success(function(b){console.log("got the data"),console.log(b),a(b)})};return{timesOfTheDay:function(){var a=d.defer();return f(function(c){console.log(c),b(function(){e.$apply(function(){a.resolve(c)})})}),a.promise}}}]),angular.module("hnlyticsApp").directive("leftNav",["$rootScope",function(){return{restrict:"EA",scope:{},controller:["$scope",function(a){a.current=1,a.setCurrent=function(b){a.current=b}}],link:function(){}}}]),angular.module("hnlyticsApp").service("chartsService",["lastPostCommentsService","topPostCommentsService","averageTimeOfDayService",function(a,b,c){var d=function(){var a=c.timesOfTheDay().then(function(a){var b={labels:["midnight","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","Noon","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"],datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#FF6600",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:a}]},c={chart:b,chartInfo:a};return c});return a},e=function(){var b=a.lastPostActivity().then(function(a){var b={labels:a.labels,datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#FF6600",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:a.commentArr}]},c={chart:b,chartInfo:a.postObj};return c});return b},f=function(){var a=b.topPostActivity().then(function(a){var b={labels:a.labels,datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#FF6600",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:a.commentArr}]},c={chart:b,chartInfo:a.postObj};return c});return a};return{timeOfDay:d,lastPostActivity:e,topPostActivity:f}}]),angular.module("hnlyticsApp").service("lastPostCommentsService",["$firebase","$q","$localStorage","$timeout","$rootScope","$http",function(a,b,c,d,e,f){var g=function(a){f.get("/api/"+e.user+"/last-post").success(function(b){console.log("got the data"),console.log(b),a(b)})};return{lastPostActivity:function(){var a=b.defer();return g(function(b){console.log(b),d(function(){e.$apply(function(){a.resolve(b)})})}),a.promise}}}]),angular.module("hnlyticsApp").service("subsByPeriodService",["$firebase","$timeout","$http","$q","$rootScope",function(){var a=function(){};return{getSubsByPeriod:a}}]),Date.prototype.getWeek=function(a){a="int"==typeof a?a:0;var b=new Date(this.getFullYear(),0,1),c=b.getDay()-a;c=c>=0?c:c+7;var d,e=Math.floor((this.getTime()-b.getTime()-6e4*(this.getTimezoneOffset()-b.getTimezoneOffset()))/864e5)+1;return 4>c?(d=Math.floor((e+c-1)/7)+1,d>52&&(nYear=new Date(this.getFullYear()+1,0,1),nday=nYear.getDay()-a,nday=nday>=0?nday:nday+7,d=4>nday?1:53)):d=Math.floor((e+c-1)/7),d},angular.module("hnlyticsApp").service("topPostCommentsService",["$firebase","$q","$localStorage","$timeout","$rootScope","$http",function(a,b,c,d,e,f){var g=function(a){f.get("/api/"+e.user+"/top-post").success(function(b){console.log("got the data"),console.log(b),a(b)})};return{topPostActivity:function(){var a=b.defer();return g(function(b){d(function(){console.log(b),e.$apply(function(){a.resolve(b)})})}),a.promise}}}]);